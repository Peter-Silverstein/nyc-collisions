---
title: "nyc-collisions-EDA"
author: "Peter Silverstein"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
# Libraries
library(tidyverse)
library(tmap)
library(leaflet)
library(sf)
library(lubridate)
```

```{r}
# Loading Central Business District Shape
cbd_geofence <- read.csv("MTA_Central_Business_District_Geofence__Beginning_June_2024_20250605.csv", stringsAsFactors = FALSE)
cbd_geofence <- st_as_sfc(cbd_geofence$polygon, crs = 2263)

# Loading collisions data
filter <- c(0, NA)

crashes <- read.csv("Motor_Vehicle_Collisions_-_Crashes_20250605.csv") %>%
  select(CRASH.DATE,
         CRASH.TIME,
         BOROUGH,
         LATITUDE,
         LONGITUDE,
         NUMBER.OF.PERSONS.INJURED,
         NUMBER.OF.PERSONS.KILLED) %>%
  filter(! LATITUDE %in% filter,
         ! LONGITUDE %in% filter) %>%
  rename(
    "date" = "CRASH.DATE",
    "time" = "CRASH.TIME",
    "borough" = "BOROUGH",
    "lat" = "LATITUDE",
    "long" = "LONGITUDE",
    "persons_inj" = "NUMBER.OF.PERSONS.INJURED",
    "persons_death" = "NUMBER.OF.PERSONS.KILLED"
  ) %>%
  mutate(
    date = mdy(date),
    time = hm(time)
    #after_cp = ,
    #cp_zone = 
  )

head(crashes)
```

```{r}
# Create an interactive map:
# Filtering to a sample
crashes_sample <- sample_n(crashes, 1000)

# Mapping
int_map <- leaflet(data = crashes_sample) %>%
  addTiles() %>%
  setView(lng = -73.9, lat = 40.7, zoom = 10) %>%
  addMarkers(~long, 
             ~lat) %>%
  addPolygons(data = cbd_geofence,
              color = "red")

int_map
```



